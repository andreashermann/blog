---
layout: post
title: 5 Wenig bekannte Features von SSH
---

SSH hat viele Features welche nicht alle gleich geläufig sind.<br /><br />Bo Jeanes hat einen tollen <a href="https://vimeo.com/54505525">Screencast</a> erstellt, welcher folgende Features und noch einige mehr live erklärt. Der Screencast dauert ca. 60 Minuten und stellt unzählige SSH-Features vor.<br /><br />Ich stelle hier kurz meine persönlichen Highlights aus dem Video vor.<br /><br /><h3>1. ProxyCommand</h3>Angenommen ich muss auf einen Host beta zugreifen via anderen Host alpha (weil er nicht direkt erreichbar ist).<br />Anstatt jedes Mal manuell <span style="font-family: Courier New, Courier, monospace;">ssh alpha</span><span style="font-family: inherit;"> gefolgt von </span><span style="font-family: Courier New, Courier, monospace;">ssh beta</span>&nbsp;aufzurufen, kann man sich eine Konfiguration mit ProxyCommand in .ssh/config anlegen <br />welche einem diese Arbeit abnimmt. Man muss danach nur noch <span style="font-family: Courier New, Courier, monospace;">ssh beta</span> eingeben um sich direkt mit dem Host zu verbinden..<br />Das Ganze funktioniert auch mit Port Forwards!<br /><br /><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-Z72AuwtVatw/VR1Y6qvWH_I/AAAAAAAAB98/hdTxXFMKanY/s1600/proxy-command.png" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img alt="proxy-command" border="0" src="http://4.bp.blogspot.com/-Z72AuwtVatw/VR1Y6qvWH_I/AAAAAAAAB98/hdTxXFMKanY/s1600/proxy-command.png" height="146" title="" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Proxy Command</td></tr></tbody></table><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />Eintrag in .ssh/config:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br />Host alpha&nbsp;&nbsp;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">HostName alpha.mydomain.com<br />&nbsp; ForwardAgent yes<br /><br />Host beta<br />&nbsp; Hostname beta.mydomain.com<br />&nbsp; ProxyCommand ssh alpha -W %h:%p</span><br /><br />Meistens findet man Beispiele mit "nc" (netcat). Da dies auf Solaris nicht überall verfügbar ist, gibt es seit OpenSSH 5.4 auch eine version ohne netcat.<br />Hier gefunden: <a href="http://www.bsdnow.tv/tutorials/ssh-chaining">http://www.bsdnow.tv/tutorials/ssh-chaining</a><br /><br /><h3>2. Dynamic Port Forwarding</h3><h3></h3>Wer schon einmal extern für eine Firma ohne VPN gearbeitet hat, kennt das Problem. Um interne Hosts zu erreichen muss man sich zuerst dutzende von SSH-Tunnels graben.<br /><br />Doch SSH unterstützt auch einen Mechanismus welcher dynamisch Port-Forwards erstellt, das "dynamic port forwarding".<br />Als Befehlt lässt es sich mit so starten:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">ssh -D 1080 alpha.mydomain.com</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;"><br /></span></span><span style="font-size: small;"><span style="font-family: inherit;">Damit wird ein lokaler SOCKS proxy auf port 1080 gestartet. Nun muss nur noch das Betriebssystem konfiguriert werden diesen Proxy zu benutzen. Danach läuft der komplette Netzwerkverkehr über alpha.</span></span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit; font-size: small;">Referenz: <a href="https://www.debian-administration.org/article/449/SSH_dynamic_port_forwarding_with_SOCKS">https://www.debian-administration.org/article/449/SSH_dynamic_port_forwarding_with_SOCKS</a> </span><br /><br /><h3>3. SSH Console </h3><span style="font-family: inherit;">Auch "SSH Escape Tilde" genannt.</span><br /><span style="font-family: inherit;">Um eine hängende SSH-Verbindung zu beenden kann man dem SSH-Client einen einfachen Befehl senden.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Nötig ist dazu die Eingabe von Tilde gefolgt von einem Punkt: <b>~.</b></span><br /><span style="font-family: inherit;">Akzeptiert wird diese Eingabe nur auf einer neuen Zeile.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Die ganze Liste aller Befehle findet sich auf der manpage von ssh.</span><br /><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~. &nbsp; &nbsp; &nbsp;Disconnect.</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~^Z &nbsp; &nbsp; Background ssh.</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~# &nbsp; &nbsp; &nbsp;List forwarded connections.</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~&amp; &nbsp; &nbsp; &nbsp;Background ssh at logout</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~? &nbsp; &nbsp; &nbsp;Display a list of escape characters.</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~B &nbsp; &nbsp; &nbsp;Send a BREAK to the remote system.</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~C &nbsp; &nbsp; &nbsp;Open command line.</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~R &nbsp; &nbsp; &nbsp;Request rekeying of the connection</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~V &nbsp; &nbsp; &nbsp;Decrease the verbosity</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;~v &nbsp; &nbsp; &nbsp;Increase the verbosity</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><br /><h3>4. Agent forwarding </h3>Um einfach von einem Host zum nächsten hüpfen zu können, kann SSH die geladenen Private-Keys an den nächsten Host weiterreichen.<br /><br /><span style="font-family: Courier New, Courier, monospace;">ssh -A alpha</span><br /><br />Der entsprechende Eintrag in .ssh/config lautet:<br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">Host alpha</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; ForwardAgent yes</span><br /><br />Der Gebrauch dieses Features sollte von einer gewissen Vorsicht begleitet werden. Falls Host alpha kompromittiert ist, könnte root auf diesem System die Agent-Verbindung ausnutzen.<br /><h3><span style="font-size: small; font-weight: normal;">Agent Forwarding kann vom Administrator eines Systems unterbunden werden mit der Direktive &nbsp;</span><span style="font-family: Courier New, Courier, monospace;"><span style="font-size: small;"><span style="font-weight: normal;">AllowAgentForwarding&nbsp;no</span></span></span><span style="font-size: small; font-weight: normal;">&nbsp;in /etc/sshd_config.</span></h3><div>Schön illustriert auf dieser Seite:</div><div><a href="http://www.unixwiz.net/techtips/ssh-agent-forwarding.html">http://www.unixwiz.net/techtips/ssh-agent-forwarding.html</a><br /><br /></div><h3>5. Keepalive</h3><div>Wer ständig im Hintergrund SSH-Sessions offen hat, der hat sich bestimmt auch schon genervt über solche Fehlermeldungen:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">[user@remote ~]$&nbsp;</span></div><div><span style="font-family: Courier New, Courier, monospace;">Write failed: Broken pipe</span></div></div><div><br /></div><div>Abhilfe bietet ein kurzer Eintrag für alle Hosts in .ssh/config:</div><div><br /></div><div><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">Host *</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; ServerAliveInterval 60</span></div><br />Auch für Windows-User gibt es eine entsprechende Option in der Putty-Konfiguration.<br /><br />Referenz:<br /><a href="https://sysadmincasts.com/episodes/39-cli-monday-how-to-keep-your-ssh-sessions-alive">https://sysadmincasts.com/episodes/39-cli-monday-how-to-keep-your-ssh-sessions-alive</a><br /><br /><br />
